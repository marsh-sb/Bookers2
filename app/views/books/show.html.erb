<div class="container px-5 px-sm-0">
	<div class="row">

	<%= render partial: 'layouts/sidebar', locals: {user:@user, new_book:@new_book} %>

	<div class="col-md-8 offset-md-1">
		<h2>Book detail</h2>

		<table class="table">
		
			<td>
				<%= link_to user_path(@user.id) do %>
				<%= attachment_image_tag @user, :profile_image, format: 'jpeg', size: "40x40", fallback: "no_image.jpg" %>
				<%= link_to @user.name, user_path(@user.id) %>
				<% end %>
			</td>
		
			<td><%= @book.title %></td>
			<td><%= @book.body %></td>

			<% if @book.user == current_user %>
			<td><%= link_to "Edit", edit_book_path(@book.id), class: "btn btn-sm btn-success"%></td>
			<td><%= link_to "Destroy", book_path(@book.id), class: "btn btn-sm btn-danger", method: :delete, "data-confirm" => "本当に消しますか？" %></td>
			<% end %>
			
			<td>
		<% if @book.favorited_by?(current_user) %>
			<p>
				<%= link_to book_favorite_path(@book), method: :delete do %>
					♥<%= @book.favorites.count %> いいね
				<% end %>
			</p>
			<% else %>
			<p>
				<%= link_to book_favorites_path(@book), method: :post do %>
					♥<%= @book.favorites.count %> いいね
				<% end %>
			</p>
		<% end %>
		</td>
		
		</table>
		
		<div class="comments">
			<p>コメント件数:<%= @book.book_comments.count %></p>
			<% @book.book_comments.each do |book_comment| %>
			<%= attachment_image_tag @book.user, :profile_image, size:"60x60", format: 'jpeg', fallback: "no_image.jpg" %>
				<%= book_comment.user.name %>
				<%= book_comment.created_at.strftime('%Y/%m/%d') %>
				<%= book_comment.comment %>
				
				<% if book_comment.user == current_user %>
					<div class="comment-delete">
						<%= link_to "削除",book_book_comment_path(book_comment.book,book_comment), class: "btn btn-sm btn-danger",method: :delete %>
					</div>
				<% end %>
			<% end %>
		</div>
		
		<div class="new-comment">
			<%= form_with(model:[@book,@book_comment],local: true) do |f| %>
				<%= f.text_area :comment, rows:'5',placeholder: "コメントをここに" %>
				<%= f.submit "送信する" %>
			<% end %> 
		</div>
		
		</div>
	</div>
</div>